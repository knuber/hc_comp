SELECT
	'PP' PERIOD, TP, IDAT, DDAT, ADAT, TDAT, COMP, CUST, BANK,INV, CUSPO, DISCA, SUM(DUE) DUE, PERD, PDAT, ACCT, OSACCT, ASCURA, ASCURB, ASEXRT
FROM
(
SELECT
	ASITYP||' - '||ASTRTP TP, 
	CHAR(ASIDAT) AS IDAT, 
	CHAR(ASDDAT) AS DDAT,
	CASE ASDUAM
		WHEN 0 THEN CHAR(ASPDAT)
		ELSE CHAR(DATE(CURRENT DATE)) 
	END ADAT,
	CASE WHEN DATE(CURRENT DATE) < ASHDAT THEN CHAR(ASHDAT) ELSE '0001-01-01' END TDAT,
	ASCOMP COMP, 
	ASCUST||' - '||RTRIM(BVNAME) CUST, 
	BVARCD BANK, 
	LTRIM(RTRIM(ASINV#)) AS INV, 
	ASCPON CUSPO,  
	CASE WHEN DATE(CURRENT DATE) < ASHDAT THEN ASHLD ELSE 0 END DISCA,
	ASDUAM DUE, 
	DIGITS(ASFSYR)||DIGITS(ASFSPR) AS PERD, 
	'' PDAT, 
	ASCOM#||ASARAC ACCT, '' OSACCT,
	ASCURA, ASCURB, ASEXRT
FROM
	LGDAT.AROPH AROP
	INNER JOIN LGDAT.CUST ON
		BVCUST = ASCUST
WHERE
	DIGITS(ASFSYR)||DIGITS(ASFSPR) <= '1704' AND 
	ASDUAM <> 0 AND ASCOMP IN ('36','39')

UNION ALL

SELECT
	LOTTYP||' - '||LOTRTP TP,
	CHAR(ASIDAT) IDAT,
	CHAR(ASDDAT) DDAT,
	CASE ASDUAM
		WHEN 0 THEN CHAR(ASPDAT)
		ELSE CHAR(DATE(CURRENT DATE)) 
	END ADAT,
	CASE WHEN DATE(CURRENT DATE) < ASHDAT THEN CHAR(ASHDAT) ELSE '0001-01-01' END TDAT, 
	LOCOMP COMP,
	LOCUST||' - '||RTRIM(BVNAME) CUST,
	BVARCD BANK,
	RTRIM(LOINV#) INV, 
	ASCPON CUSPO,
	CASE WHEN DATE(CURRENT DATE) < ASHDAT THEN ASHLD ELSE 0 END DISCA,
	-LOAMT DUE,
	DIGITS(ASFSYR)||DIGITS(ASFSPR) AS PERD,
	CHAR(LOTDAT) PDAT,
	ASCOM#||ASARAC ACCT, LOCOM#||LOARAC OSACCT,
	ASCURA, ASCURB, ASEXRT

FROM
	LGDAT.ARTRN
	INNER JOIN LGDAT.CUST ON
		BVCUST = LOCUST
	LEFT OUTER JOIN LGDAT.AROPH ON
		LOCOM# = ASCOM# AND
		LOCUST = ASCUST AND
		LOINV# = ASINV#
		
WHERE
	DIGITS(LOFSYR)||DIGITS(LOFSPR) > '1704' AND
	DIGITS(ASFSYR)||DIGITS(ASFSPR) <= '1704' AND LOCOMP IN ('36','39')
) X
GROUP BY
	TP, IDAT, DDAT, ADAT, TDAT, COMP, CUST, BANK,INV, CUSPO, DISCA, PERD, PDAT, ACCT, OSACCT,ASCURA, ASCURB, ASEXRT