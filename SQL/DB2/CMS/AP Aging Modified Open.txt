SELECT 
		DIGITS(FHPYY)||DIGITS(FHPPER) AS PERIOD, 
		CHAR(FHIDAT) IDAT, 
		CHAR(FHDDAT) DDAT, 
		FHCOM#, 
		FHVEN# VEN#, 
		RTRIM(BTNAME) DESCR, 
		RTRIM(FHVEN#)||' - '||RTRIM(BTNAME) VEND_DESCR, 
 		FHBANK, 
 		FHVCH#, 
 		FHINV# AS INVOICE, 
 		FHVDES, 
 		FHCURR, 
 		FHCBAL AMT, 
 		ROUND(FHCBAL*RATE,2) AMT_USD 
	FROM 
		LGDAT.OPEN
		LEFT OUTER JOIN LGDAT.VEND ON 
			BTVEND = FHVEN# 
		LEFT OUTER JOIN LGDAT.VCHR ON 
			IDVCH# = FHVCH# AND 
			IDCOM# = FHCOM# AND 
			IDBNK# = FHBANK AND 
			IDFISY = FHPYY AND 
			IDFISP = FHPPER 
		LEFT OUTER JOIN FANALYSIS.FFCRET X ON 
			FCUR = FHCURR AND
			TCUR = 'US' AND
			RTYP = 'ME' AND
			X.PERD = '1510'
	WHERE 
		FHCBAL <> 0 AND 
		DIGITS(FHPYY)||DIGITS(FHPPER) >= '0901' AND
		DIGITS(FHPYY)||DIGITS(FHPPER) <= '1510'

UNION ALL

SELECT
	DIGITS(FHPYY)||DIGITS(FHPPER) PERIOD,
	CHAR(FHIDAT) IDAT, 
	CHAR(FHDDAT) DDAT, 
	AVTCO#, 
	IDVEN# VEN#,
	RTRIM(BTNAME) DESCR, 
	IDVEN#||' - '||RTRIM(BTNAME) VEND_DESCR,
	IDBNK#, 
	AVTVH#, 
	IDINV# INVOICE, 
	IDVDES,
	FHCURR, 
	AVTVAM* CASE AVTTYP WHEN 1 THEN -1 WHEN 7 THEN -1 ELSE 1 END AMT,
	AVTVAM* CASE AVTTYP WHEN 1 THEN -1 WHEN 7 THEN -1 ELSE 1 END*RATE AMT_USD
FROM
	LGDAT.AVTX 
	LEFT OUTER JOIN LGDAT.VCHR ON
		IDCOM# = AVTCO# AND
		IDVCH# = AVTVH#
	LEFT OUTER JOIN LGDAT.VEND ON
		BTVEND = IDVEN#
	LEFT OUTER JOIN LGDAT.OPEN ON
		FHCOM# = AVTCO# AND
		FHVCH# = AVTVH#
	LEFT OUTER JOIN FANALYSIS.FFCRET ON
		FCUR = FHCURR AND
		TCUR = 'US' AND
		RTYP = 'ME' AND
		PERD = '1510'
WHERE
	AVTFIS > '201510' AND DIGITS(FHPYY)||DIGITS(FHPPER) <= '1510'