SELECT
	AVTTYP, CHAR(FHIDAT) IDAT, CHAR(FHDDAT) DDAT, AVTCO#, IDVEN#||' - '||BTNAME VEND, IDBNK#, AVTVH#, IDINV#, IDVDES, 
	AVTVAM* CASE AVTTYP WHEN 1 THEN -1 WHEN 7 THEN -1 ELSE 1 END AMT, 
	SUBSTR(AVTFIS,3,4) AS PERD, FHCURR
FROM
	LGDAT.AVTX 
	LEFT OUTER JOIN LGDAT.VCHR ON
		IDCOM# = AVTCO# AND
		IDVCH# = AVTVH#
	LEFT OUTER JOIN LGDAT.VEND ON
		BTVEND = IDVEN#
	LEFT OUTER JOIN LGDAT.OPEN ON
		FHCOM# = AVTCO# AND
		FHVCH# = AVTVH#
WHERE
	AVTFIS > '20'||? AND DIGITS(IDFISY)||DIGITS(IDFISP) <= ?

UNION ALL

SELECT
	'OPEN',
	CHAR(FHIDAT) IDAT, CHAR(FHDDAT) DDAT,
	FHCOM#,  
	RTRIM(FHVEN#)||' - '||RTRIM(BTNAME) VEND,
	FHBANK,
	FHVCH#,
	FHINV# AS INVOICE, 
	FHVDES,
	FHCBAL AMT,
	DIGITS(FHPYY)||DIGITS(FHPPER) AS PERIOD, FHCURR
FROM
	LGDAT.OPEN
	LEFT OUTER JOIN LGDAT.VEND ON
		BTVEND = FHVEN#
	LEFT OUTER JOIN LGDAT.VCHR ON
		IDVCH# = FHVCH# AND
		IDCOM# = FHCOM# AND
		IDBNK# = FHBANK AND
		IDFISY = FHPYY AND
		IDFISP = FHPPER
WHERE
	FHCBAL <> 0 AND DIGITS(FHPYY)||DIGITS(FHPPER) >= '0901' AND
	DIGITS(FHPYY)||DIGITS(FHPPER) <= ?